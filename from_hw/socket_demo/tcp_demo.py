from socket import *

# 创建socket
from scapy.contrib.automotive.someip import SOMEIP
from scapy.layers.l2 import Ether
from scapy.utils import hexdump

tcp_client_socket = socket(AF_INET, SOCK_STREAM)

server_ip = "192.168.0.100"
server_port = 30490

tcp_client_socket.connect((server_ip, server_port))

someip = SOMEIP(srv_id=0x0100, sub_id=0x0,
                method_id=0x3b, client_id=0x1, session_id=0x1,
                msg_type=SOMEIP.TYPE_REQUEST, retcode=SOMEIP.RET_E_OK)

combine_payload = ["FE", "FF", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "00", "00"]
payload = b''.join([bytes().fromhex(i) for i in combine_payload])
payload = someip / payload # 拼接payload

payload = hexdump(payload, True)
results = payload.split("\n")
finalResult = []
for item in results:
    finalResult.append(item.split("  ")[1])
x = " ".join(finalResult)
payload = x.split(" ")
payload = b''.join([bytes().fromhex(i) for i in payload])

tcp_client_socket.send(payload)
print(payload)
# 04806900520164064621301921681216925418525251112191204311322469700001282255255647200111338245180420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

recv = tcp_client_socket.recv(1024 * 1024)
print('接收到的数据为:', recv)

parse_someip = SOMEIP(recv)
parse_someip.show()

tcp_client_socket.close()
